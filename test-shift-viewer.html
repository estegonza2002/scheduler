<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shift-203 Viewer</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }

        h1,
        h2,
        h3 {
            color: #333;
        }

        pre {
            background-color: #f5f5f5;
            padding: 10px;
            border-radius: 5px;
            overflow: auto;
        }

        .task-list {
            list-style: none;
            padding: 0;
        }

        .task-list li {
            padding: 8px;
            border-bottom: 1px solid #eee;
            display: flex;
            align-items: center;
        }

        .task-list input[type="checkbox"] {
            margin-right: 10px;
        }

        .completed {
            text-decoration: line-through;
            color: #888;
        }

        .error {
            color: red;
            font-weight: bold;
        }
    </style>
</head>

<body>
    <h1>Shift-203 Data Viewer</h1>

    <div id="loading">Loading shift data...</div>
    <div id="error" class="error" style="display: none;"></div>

    <div id="shift-details" style="display: none;">
        <h2>Shift Details</h2>
        <div id="shift-info"></div>

        <h3>Check-in Tasks</h3>
        <ul id="check-in-tasks" class="task-list">
            <!-- Tasks will be added here -->
        </ul>

        <h3>Check-out Tasks</h3>
        <ul id="check-out-tasks" class="task-list">
            <!-- Tasks will be added here -->
        </ul>
    </div>

    <h3>Raw Data</h3>
    <pre id="raw-data"></pre>

    <script>
        document.addEventListener('DOMContentLoaded', async () => {
            try {
                // Try to fetch from our server
                let shiftData;
                try {
                    const response = await fetch('http://localhost:5189/shifts/shift-203');
                    if (!response.ok) {
                        throw new Error(`Server returned ${response.status}: ${response.statusText}`);
                    }
                    shiftData = await response.json();
                    console.log("Successfully fetched data from server");
                } catch (fetchError) {
                    console.warn("Server fetch failed, using fallback data:", fetchError);
                    // Fallback to hardcoded data if server is not available
                    shiftData = {
                        id: "shift-203",
                        scheduleId: "sch-5",
                        employeeId: "emp-1",
                        startTime: "2025-03-25T08:00:00",
                        endTime: "2025-03-25T16:00:00",
                        role: "Supervisor",
                        locationId: "loc-1",
                        notes: "**Shift Briefing: Special Events Day**\n\nThis shift requires extra attention due to the following factors:\n- VIP client from overseas visiting at 2pm\n- Training new staff members during the afternoon rush\n- meeting with management at 1:30pm to discuss workflow improvements\n\n*Please ensure all check-in and check-out tasks are completed thoroughly.*\n\nRush hour expected between 4-6pm. Additional staff will be on call if needed.\n\nVehicle inspection at 3:15pm with regional safety coordinator.",
                        checkInTasks: [
                            {
                                id: "task-ci-1",
                                description: "Review daily schedule and special events",
                                completed: true
                            },
                            {
                                id: "task-ci-2",
                                description: "Verify all safety equipment is in place",
                                completed: false
                            },
                            {
                                id: "task-ci-3",
                                description: "Prepare VIP welcome package for afternoon visitors",
                                completed: false
                            }
                        ],
                        checkOutTasks: [
                            {
                                id: "task-co-1",
                                description: "Complete closing inventory count",
                                completed: false
                            },
                            {
                                id: "task-co-2",
                                description: "Lock all secure areas and safes",
                                completed: true
                            },
                            {
                                id: "task-co-3",
                                description: "Submit end-of-day reports",
                                completed: false
                            }
                        ]
                    };
                }

                // Display raw data
                document.getElementById('raw-data').textContent = JSON.stringify(shiftData, null, 2);

                // Display shift details
                document.getElementById('shift-details').style.display = 'block';

                // Format and display basic info
                const startDate = new Date(shiftData.startTime);
                const endDate = new Date(shiftData.endTime);

                document.getElementById('shift-info').innerHTML = `
                    <p><strong>ID:</strong> ${shiftData.id}</p>
                    <p><strong>Role:</strong> ${shiftData.role}</p>
                    <p><strong>Date:</strong> ${startDate.toLocaleDateString()}</p>
                    <p><strong>Time:</strong> ${startDate.toLocaleTimeString()} - ${endDate.toLocaleTimeString()}</p>
                    <p><strong>Notes:</strong> <br>${shiftData.notes.replace(/\n/g, '<br>')}</p>
                `;

                // Render check-in tasks
                const checkInTasksEl = document.getElementById('check-in-tasks');
                renderTasks(shiftData.checkInTasks, checkInTasksEl);

                // Render check-out tasks
                const checkOutTasksEl = document.getElementById('check-out-tasks');
                renderTasks(shiftData.checkOutTasks, checkOutTasksEl);

                document.getElementById('loading').style.display = 'none';

            } catch (error) {
                document.getElementById('loading').style.display = 'none';
                document.getElementById('error').style.display = 'block';
                document.getElementById('error').textContent = `Error: ${error.message}`;
                console.error('Error processing shift data:', error);
            }
        });

        function renderTasks(tasks, container) {
            if (!tasks || tasks.length === 0) {
                container.innerHTML = '<li>No tasks available</li>';
                return;
            }

            container.innerHTML = '';
            tasks.forEach(task => {
                const li = document.createElement('li');

                const checkbox = document.createElement('input');
                checkbox.type = 'checkbox';
                checkbox.checked = task.completed;
                checkbox.disabled = true;

                const span = document.createElement('span');
                span.textContent = task.description;
                if (task.completed) {
                    span.classList.add('completed');
                }

                li.appendChild(checkbox);
                li.appendChild(span);
                container.appendChild(li);
            });
        }
    </script>
</body>

</html>